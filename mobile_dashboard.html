<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile SEO Bot Dashboard</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #121212; color: #e0e0e0; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; background-color: #1e1e1e; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
        h1 { color: #bb86fc; text-align: center; }
        .controls, .stats, .config { background-color: #2c2c2c; padding: 15px; border-radius: 6px; margin-bottom: 20px; }
        .controls button { background-color: #03dac6; color: #121212; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; font-size: 16px; margin-right: 10px; transition: background-color 0.3s; }
        .controls button.stop { background-color: #cf6679; }
        .controls button:hover { opacity: 0.9; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; text-align: center; }
        .stat-item { background-color: #3e3e3e; padding: 15px; border-radius: 4px; }
        .stat-item h3 { margin: 0 0 10px; color: #bb86fc; font-size: 14px; text-transform: uppercase; }
        .stat-item p { margin: 0; font-size: 24px; font-weight: bold; }
        .config input, .config textarea { width: 100%; padding: 8px; background-color: #3e3e3e; color: #e0e0e0; border: 1px solid #555; border-radius: 4px; margin-bottom: 10px; box-sizing: border-box; }
        .config textarea { resize: vertical; min-height: 80px; }
        .log-container { background-color: #2c2c2c; padding: 15px; border-radius: 6px; height: 300px; overflow-y: auto; font-family: "Courier New", Courier, monospace; font-size: 14px; line-height: 1.5; }
        .log-entry { padding: 2px 5px; border-radius: 3px; margin-bottom: 5px; }
        .log-entry.info { background-color: #3a3a3a; }
        .log-entry.success { background-color: #2e7d32; }
        .log-entry.error { background-color: #b71c1c; }
        .status-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; margin-left: 10px; }
        .status-indicator.running { background-color: #66bb6a; }
        .status-indicator.stopped { background-color: #ef5350; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Mobile SEO Bot</h1>
        
        <div class="controls">
            <button id="startButton">START</button>
            <button id="stopButton" class="stop">STOP</button>
            <span id="statusIndicator" class="status-indicator stopped"></span>
        </div>

        <div class="stats">
            <div class="stats-grid">
                <div class="stat-item">
                    <h3>Ziyaret Sayısı</h3>
                    <p id="visitCount">0</p>
                </div>
                <div class="stat-item">
                    <h3>Başarılı</h3>
                    <p id="successCount">0</p>
                </div>
                <div class="stat-item">
                    <h3>Hatalı</h3>
                    <p id="errorCount">0</p>
                </div>
            </div>
        </div>

        <div class="config">
            <input type="text" id="targetUrl" placeholder="Hedef URL (örn: https://example.com)">
            <textarea id="keywords" placeholder="Anahtar Kelimeler (her satıra bir tane)"></textarea>
            <input type="number" id="visitsPerMinute" placeholder="Dakika Başına Ziyaret">
            <input type="number" id="totalVisitLimit" placeholder="Toplam Ziyaret Limiti (0 = sonsuz)">
            <button id="saveConfigButton">Ayarları Kaydet</button>
        </div>

        <div class="log-container" id="logContainer"></div>
    </div>

    <script>
        const ws = new WebSocket(`ws://${window.location.hostname}:8090`);

        const startButton = document.getElementById("startButton");
        const stopButton = document.getElementById("stopButton");
        const saveConfigButton = document.getElementById("saveConfigButton");
        const logContainer = document.getElementById("logContainer");
        
        const visitCountEl = document.getElementById("visitCount");
        const successCountEl = document.getElementById("successCount");
        const errorCountEl = document.getElementById("errorCount");
        const statusIndicator = document.getElementById("statusIndicator");

        const targetUrlInput = document.getElementById("targetUrl");
        const keywordsInput = document.getElementById("keywords");
        const visitsPerMinuteInput = document.getElementById("visitsPerMinute");
        const totalVisitLimitInput = document.getElementById("totalVisitLimit");

        ws.onopen = () => {
            addLog("WebSocket bağlantısı kuruldu.", "success");
        };

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === "log") {
                addLog(data.message, data.logType, data.ip);
            } else if (data.type === "stats") {
                updateStats(data.data);
            }
        };

        ws.onclose = () => {
            addLog("WebSocket bağlantısı kapandı.", "error");
            updateStatus(false);
        };

        ws.onerror = (error) => {
            addLog("WebSocket hatası!", "error");
            console.error("WebSocket Error:", error);
        };

        function addLog(message, type = "info", ip = null) {
            const entry = document.createElement("div");
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.innerHTML = `[${timestamp}] ${ip ? `[${ip}]` : ""} ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateStats(stats) {
            visitCountEl.textContent = stats.visitCount;
            successCountEl.textContent = stats.successCount;
            errorCountEl.textContent = stats.errorCount;
            updateStatus(stats.botRunning);
        }

        function updateStatus(isRunning) {
            if (isRunning) {
                statusIndicator.classList.remove("stopped");
                statusIndicator.classList.add("running");
            } else {
                statusIndicator.classList.remove("running");
                statusIndicator.classList.add("stopped");
            }
        }

        startButton.addEventListener("click", () => {
            ws.send(JSON.stringify({ action: "start" }));
            addLog("Başlatma komutu gönderildi.", "info");
        });

        stopButton.addEventListener("click", () => {
            ws.send(JSON.stringify({ action: "stop" }));
            addLog("Durdurma komutu gönderildi.", "info");
        });

        saveConfigButton.addEventListener("click", () => {
            const keywords = keywordsInput.value.split("\n").filter(k => k.trim() !== "");
            const config = {
                action: "config",
                targetUrl: targetUrlInput.value,
                keywords: keywords,
                visitsPerMinute: parseInt(visitsPerMinuteInput.value, 10),
                totalVisitLimit: parseInt(totalVisitLimitInput.value, 10)
            };
            ws.send(JSON.stringify(config));
            addLog("Yeni ayarlar gönderildi.", "success");
        });

    </script>
</body>
</html>
